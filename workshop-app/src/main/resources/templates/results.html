<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Results Page</title>

    <!--<link rel="stylesheet" type="text/css" th:href="@{/css/results.css}" />-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.15/css/dataTables.bootstrap.min.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" language="javascript"
            src="https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" language="javascript"
            src="https://cdn.datatables.net/1.10.15/js/dataTables.bootstrap.min.js"></script>
</head>

<body>
<script>
    $(document).ready(function () {
        $('#results').DataTable();

        $("#sendMailForm").submit(function (e) {
            $.ajax({
                type: "POST",
                url: "/results/sendemail",
                data: $("#sendMailForm").serialize(),
                success: function (response) {
                    alert("Success, " + response);
                    window.location.href = '/home';
                },
                error: function () {
                    alert("Error, Email was not sent.");
                }
            });
            e.preventDefault();
        });
    });
</script>
<div class="container">

    <br>
    <div class="row">
        <form th:action="@{/logout}" method="get">
            <button class="btn btn-md btn-danger btn-block" name="registration"
                    type="Submit">Logout
            </button>
        </form>
    </div>
    <br>
    <br>
    <div class="row" style="padding-bottom:2em;" th:if="${!results.isEmpty() && isAdmin}">
        <form class="form-inline col-md-2 col-md-offset-8 row" id="sendMailForm">
            <input type="hidden" name="resultsId" th:value="${results[0].id}">
            <input type="hidden" name="userEmail" th:value="${userEmail}">
            <button type="submit" class="btn btn-success btn-block">Send Mail</button>
        </form>

        <form class="col-md-2" th:action="@{/results/view/mail}" method="get">
            <input type="hidden" name="resultsId" th:value="${results[0].id}">
            <button type="button" class="btn btn-primary btn-md btn-block" type="Submit">Mail Preview
            </button>
        </form>
    </div>
    <div class="row">
        <div class="table-responsive">
            <table id="results" class="table table-bordered table-striped table-hover">
                <thead>
                <tr>
                    <th>#</th>
                    <th>Title</th>
                    <th>Sentiment Polarity</th>
                    <th>Categories</th>
                    <th>Domain</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="result,iterationstatus :${results}">
                    <td th:text="${iterationstatus.count}">1</td>
                    <td th:text="${result.title}">Title</td>
                    <td th:text="${result.sentiment.polarity}">Sentiment Polarity</td>
                    <td>
                        <ul>
                            <li th:each="item : ${result.classifications}" th:text="${item}">Classification</li>
                        </ul>
                    </td>
                    <td th:text="${result.domain}"> Domain</td>
                    <td>
                        <form th:action="@{/results/view/article}" method="get">
                            <input type="hidden" name="resultsId" th:value="${result.id}">
                            <input type="hidden" name="index" th:value="${iterationstatus.count - 1}">
                            <input type="hidden" name="userEmail" th:value="${userEmail}">
                            <button class="btn btn-md btn-danger" type="Submit">Read More</button>
                        </form>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

    </div>
</div>
</body>
</html>